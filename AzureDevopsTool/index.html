<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Azure DevOps - Bulk Comment Tool (New Layout)</title>
    
    <!-- Favicon -->
    <link rel="icon" href="https://infoprojekt.pl/wp-content/uploads/2023/05/cropped-294519568_900723907507766_3391103053866495891_n-32x32.png" sizes="32x32" />
    <link rel="icon" href="https://infoprojekt.pl/wp-content/uploads/2023/05/cropped-294519568_900723907507766_3391103053866495891_n-192x192.png" sizes="192x192" />
    <link rel="apple-touch-icon" href="https://infoprojekt.pl/wp-content/uploads/2023/05/cropped-294519568_900723907507766_3391103053866495891_n-180x180.png" />
    
    <!-- Font Awesome 6.4.0 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <!-- External CSS -->
    <link rel="stylesheet" href="styles.css" />
    
    <!-- ============================================================================
         ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è TESTING CONFIGURATION - REMOVE BEFORE GIT COMMIT ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è
         ============================================================================
         This section contains temporary PAT token for testing purposes.
         MUST BE REMOVED before committing to git repository!
         GitHub will block push if PAT token is detected in commits.
         ============================================================================ -->
    <script>
        // TEMPORARY PAT TOKEN - DELETE BEFORE COMMIT!
        const TESTING_PAT_TOKEN = '';
        // To use: paste this token in Settings tab or it will auto-load on page load
    </script>
    <!-- ============================================================================ -->
</head>
<body>
    <!-- Top Navigation -->
    <div class="top-nav">
        <div class="top-nav-content">
            <div class="top-nav-title">
                <img src="https://infoprojekt.pl/wp-content/uploads/2022/08/infoprojekt-logo.png" alt="Infoprojekt" style="height: 30px; margin-right: 15px;" />
                <i class="fas fa-comment-dots"></i>
                Azure DevOps Bulk Comment Tool
            </div>
            <div class="top-nav-user">
                <i class="fas fa-user-circle"></i>
            </div>
        </div>
    </div>
    
    <div class="container">
        <div style="padding: 30px;">
        <h1><i class="fas fa-tools"></i> Azure DevOps - Bulk Comment Tool</h1>
        <p class="subtitle">Add predefined comments to work items based on Planned Release and Status</p>
        <div style="background: #f8f9fa; border-left: 4px solid #667eea; padding: 12px 15px; margin-bottom: 20px; border-radius: 4px;">
            <p style="margin: 0 0 5px 0; font-size: 13px; color: #495057;">
                <i class="fas fa-info-circle" style="color: #667eea;"></i> 
                <strong>Setup:</strong> Azure DevOps PAT (Personal Access Token) is required. Configure it in the <strong>Settings</strong> tab.
            </p>
            <p style="margin: 0; font-size: 13px; color: #dc3545; font-weight: 600;">
                <i class="fas fa-exclamation-triangle"></i> 
                <strong>Important:</strong> Remember to clear PAT token when you finish using the tool to keep your credentials secure!
            </p>
        </div>
        
        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('main')"><i class="fas fa-home"></i> Main</button>
            <button class="tab-btn" onclick="switchTab('settings')"><i class="fas fa-cog"></i> Settings</button>
        </div>
        
        <!-- Main Tab -->
        <div id="mainTab" class="tab-content active">
        
        <!-- Filters Section -->
        <div class="config-section">
            <h2><i class="fas fa-filter"></i> Filters</h2>
            <div class="filter-row" style="align-items: flex-start;">
                <div class="form-group" style="flex: 1;">
                    <label>Planned Release</label>
                    <input type="text" id="plannedRelease" placeholder="e.g. 26.3.0 or 26.3.0.INT" onchange="checkMultipleVersions()" />
                    <div style="margin-top: 5px;">
                        <label style="display: flex; align-items: center; gap: 5px; cursor: pointer; font-size: 12px; font-weight: normal;">
                            <input type="radio" name="matchType" id="exactMatch" value="exact" checked style="margin: 0;" />
                            Exact match
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px; cursor: pointer; font-size: 12px; font-weight: normal;">
                            <input type="radio" name="matchType" id="containsMatch" value="contains" style="margin: 0;" />
                            Contains (finds items with multiple versions)
                        </label>
                    </div>
                    <div id="versionDetectionInfo" style="display: none; background: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; padding: 6px; margin-top: 5px; font-size: 11px; color: #856404;">
                        <i class="fas fa-exclamation-triangle"></i> Multiple versions detected. Consider using <strong>Contains</strong> to find all work items.
                    </div>
                    <small style="color: #666; font-size: 11px; display: block; margin-top: 3px;">Enter the value from Custom.plannedrelease field</small>
                </div>
                <div class="form-group" style="flex: 1;">
                    <label>Status</label>
                    <select id="status">
                        <option value="">All</option>
                        <option value="New">New</option>
                        <option value="Active">Active</option>
                        <option value="Development">Development</option>
                        <option value="Integration">Integration</option>
                        <option value="Resolved">Resolved</option>
                        <option value="Ready for Test">Ready for Test</option>
                        <option value="Closed">Closed</option>
                    </select>
                </div>
                <div class="form-group" style="flex: 1;">
                    <label>Work Item Type</label>
                    <div style="border: 1px solid #ddd; border-radius: 4px; padding: 8px; background: #f8f9fa;">
                        <div style="margin-bottom: 6px;">
                            <button type="button" class="btn-secondary" onclick="selectAllTypes()" style="padding: 3px 6px; font-size: 11px; margin-right: 4px;"><i class="fas fa-check-square"></i> All</button>
                            <button type="button" class="btn-secondary" onclick="deselectAllTypes()" style="padding: 3px 6px; font-size: 11px;"><i class="fas fa-square"></i> None</button>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 6px;">
                            <label style="display: flex; align-items: center; gap: 5px; cursor: pointer; font-size: 12px; font-weight: normal;">
                                <input type="checkbox" id="typeAll" value="All" checked onchange="toggleWorkItemType(this)" style="margin: 0;" />
                                All
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px; cursor: pointer; font-size: 12px; font-weight: normal;">
                                <input type="checkbox" id="typeBug" value="Bug" checked onchange="toggleWorkItemType(this)" style="margin: 0;" />
                                Bug
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px; cursor: pointer; font-size: 12px; font-weight: normal;">
                                <input type="checkbox" id="typeUserStory" value="User Story" checked onchange="toggleWorkItemType(this)" style="margin: 0;" />
                                User Story
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px; cursor: pointer; font-size: 12px; font-weight: normal;">
                                <input type="checkbox" id="typeTask" value="Task" checked onchange="toggleWorkItemType(this)" style="margin: 0;" />
                                Task
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px; cursor: pointer; font-size: 12px; font-weight: normal;">
                                <input type="checkbox" id="typeFeature" value="Feature" checked onchange="toggleWorkItemType(this)" style="margin: 0;" />
                                Feature
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px; cursor: pointer; font-size: 12px; font-weight: normal;">
                                <input type="checkbox" id="typeTestFeedback" value="TestFeedback" checked onchange="toggleWorkItemType(this)" style="margin: 0;" />
                                TestFeedback
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            <button onclick="fetchWorkItems()" style="margin-top: 15px;"><i class="fas fa-search"></i> Fetch Work Items</button>
        </div>
        
        <!-- Comment Template Section -->
        <div class="config-section">
            <h2><i class="fas fa-comment-dots"></i> Comment Template</h2>
            <div class="form-group">
                <label>Select Comment Template</label>
                <select id="commentTemplate" onchange="updatePreview()">
                    <option value="readyForTest">Ready for Test</option>
                    <option value="closed">Closed</option>
                    <option value="custom">Custom (edit below)</option>
                </select>
            </div>
            <div class="form-group" style="margin-top: 15px;">
                <label>Comment Text (editable)</label>
                <textarea id="customCommentText" rows="8" style="font-family: 'Courier New', monospace; font-size: 13px;" onchange="updatePreview()"></textarea>
                <small style="color: #666; font-size: 11px; margin-top: 5px; display: block;">
                    Available placeholders: {PLANNED_RELEASE}, {DEVELOPER}, {TESTER}
                </small>
            </div>
        </div>
        
        <!-- Single Item Section -->
        <div class="single-item-section">
            <h3><i class="fas fa-file-alt"></i> Add Comment to Single Item (by ID)</h3>
            <div class="inline-form">
                <div class="form-group">
                    <label>Work Item ID</label>
                    <input type="number" id="singleItemId" placeholder="e.g., 12345" style="width: 150px;" />
                </div>
                <button class="btn-secondary" onclick="fetchSingleItem()"><i class="fas fa-eye"></i> Preview Item</button>
                <button class="btn-success" onclick="addCommentToSingleItem()"><i class="fas fa-plus-circle"></i> Add Comment to This Item</button>
            </div>
        </div>
        
        <div id="loadingIndicator" class="loading" style="display: none;">
            <div class="spinner"></div>
            <p>Loading work items...</p>
        </div>
        
        <div id="errorMessage"></div>
        
        <!-- Work Items Section -->
        <div class="work-items-section" id="workItemsSection" style="display: none;">
            <div class="work-items-header">
                <h2><i class="fas fa-list"></i> Work Items</h2>
                <div class="stats">
                    <div class="stat">
                        <span>Total:</span>
                        <strong id="totalCount">0</strong>
                    </div>
                    <div class="stat">
                        <span>Selected:</span>
                        <strong id="selectedCount">0</strong>
                    </div>
                </div>
            </div>
            
            <div class="actions-bar" style="align-items: center;">
                <button class="btn-success" onclick="addCommentsToSelected()"><i class="fas fa-comments"></i> Add Comments to Selected</button>
                <button class="btn-secondary" onclick="selectAll()"><i class="fas fa-check-square"></i> Select All</button>
                <button class="btn-secondary" onclick="selectWithoutComment()"><i class="fas fa-check-circle"></i> Select Without Comment</button>
                <button class="btn-secondary" onclick="deselectAll()"><i class="fas fa-square"></i> Deselect All</button>
                <div style="border-left: 2px solid #dee2e6; height: 30px; margin: 0 5px;"></div>
                <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 12px; background: #fff3cd; padding: 5px 10px; border-radius: 4px; border: 1px solid #ffc107;">
                    <input type="checkbox" id="filterMultipleVersions" onchange="displayWorkItems()" style="margin: 0;" />
                    <i class="fas fa-filter"></i> Multiple versions
                </label>
                <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 12px; background: #d1ecf1; padding: 5px 10px; border-radius: 4px; border: 1px solid #17a2b8;">
                    <input type="checkbox" id="filterWithoutComment" onchange="displayWorkItems()" style="margin: 0;" />
                    <i class="fas fa-filter"></i> Without comment
                </label>
                <div style="border-left: 2px solid #dee2e6; height: 30px; margin: 0 5px;"></div>
                <button class="btn-danger" onclick="clearResults()"><i class="fas fa-trash"></i> Clear Results</button>
            </div>
            
            <table class="work-items-table" id="workItemsTable">
                <thead>
                    <tr>
                        <th class="checkbox-cell">
                            <input type="checkbox" id="selectAllCheckbox" onchange="toggleSelectAll()" />
                        </th>
                        <th>ID</th>
                        <th>Type</th>
                        <th>Title</th>
                        <th>Status</th>
                        <th>Planned Release</th>
                        <th>Assigned To</th>
                        <th>DEV Task</th>
                        <th>INT Task</th>
                        <th style="text-align: center; width: 50px;">‚ö†Ô∏è</th>
                    </tr>
                </thead>
                <tbody id="workItemsBody">
                </tbody>
            </table>
        </div>
        
        <!-- Preview Section -->
        <div class="preview-section" id="previewSection" style="display: none;">
            <h3>üëÅÔ∏è Comment Preview (for first selected item)</h3>
            <div class="preview-comment" id="previewComment"></div>
        </div>
        
        </div>
        <!-- End Main Tab -->
        
        <!-- Settings Tab -->
        <div id="settingsTab" class="tab-content">
            <div class="config-section">
                <h2><i class="fas fa-cog"></i> Configuration</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label><i class="fas fa-building"></i> Organization</label>
                        <select id="organization" onchange="updateProjectList()">
                        </select>
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-folder"></i> Project</label>
                        <select id="project">
                        </select>
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-key"></i> Personal Access Token (PAT)</label>
                        <input type="password" id="pat" placeholder="Your PAT token" />
                    </div>
                </div>
                <button onclick="saveConfig()"><i class="fas fa-save"></i> Save Configuration</button>
                <button class="btn-secondary" onclick="loadConfig()"><i class="fas fa-download"></i> Load Saved</button>
                <button class="btn-danger" onclick="clearPAT()"><i class="fas fa-eraser"></i> Clear PAT Token</button>
            </div>
        </div>
        <!-- End Settings Tab -->
        
        </div><!-- End padding wrapper -->
    </div><!-- End container -->
    
    <!-- External JavaScript -->
    <script src="script.js"></script>
</body>
</html>
