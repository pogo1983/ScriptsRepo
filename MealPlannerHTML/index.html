<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Planner Tygodniowy ‚Äì Jad≈Çospis Dynamiczny</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>
<div class="container">
  <h1>üçΩÔ∏è Planner Dietetyczny</h1>
  <p class="intro">Wybierz dania na ka≈ºdy dzie≈Ñ tygodnia dla <span class="person-michalina">Michaliny</span> i <span class="person-marcin">Marcina</span>.<br>
  Po wyborze wszystkich posi≈Çk√≥w, wygeneruj jad≈Çospis i automatycznƒÖ listƒô zakup√≥w!</p>
  
  <div class="info-box">
    <h3 style="margin-top: 0; color: #2196f3;">üìä Cel kaloryczny dzienny</h3>
    <div style="display: flex; gap: 20px; flex-wrap: wrap; margin-top: 15px;">
      <div style="flex: 1; min-width: 200px;">
        <label style="display: block; margin-bottom: 8px;"><strong class="person-michalina">Michalina:</strong></label>
        <select id="caloriesMichalina" onchange="updateCalories()" style="width: 100%; padding: 8px; border: 2px solid #e91e63; border-radius: 5px; font-size: 14px;">
          <option value="1000">1000 kcal</option>
          <option value="1300" selected>1300 kcal</option>
          <option value="1500">1500 kcal</option>
          <option value="1800">1800 kcal</option>
          <option value="2000">2000 kcal</option>
          <option value="2500">2500 kcal</option>
        </select>
      </div>
      <div style="flex: 1; min-width: 200px;">
        <label style="display: block; margin-bottom: 8px;"><strong class="person-marcin">Marcin:</strong></label>
        <select id="caloriesMarcin" onchange="updateCalories()" style="width: 100%; padding: 8px; border: 2px solid #2196f3; border-radius: 5px; font-size: 14px;">
          <option value="1500">1500 kcal</option>
          <option value="2000">2000 kcal</option>
          <option value="2500" selected>2500 kcal</option>
          <option value="3000">3000 kcal</option>
        </select>
      </div>
    </div>
    <small style="color: #666; display: block; margin-top: 10px;">üí° Gramatury sk≈Çadnik√≥w bƒôdƒÖ automatycznie dostosowane do wybranego celu</small>
  </div>
  
  <div style="background: #f0f7ff; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #236be8;">
    <h3 style="margin-top: 0; color: #236be8;">üíä Suplementacja</h3>
    <p style="margin: 5px 0;"><strong class="person-michalina">Michalina:</strong> Witamina D3+K2 (2000IU), Omega-3, Multiwitamina/probiotyk, Izolat bia≈Çka (w razie braku bia≈Çka w diecie)</p>
    <p style="margin: 5px 0;"><strong class="person-marcin">Marcin:</strong> Witamina D3 (2000IU), Omega-3, Magnez, Izolat bia≈Çka (po biegu)</p>
    <small style="color: #666;">* Suplementacja po konsultacji z lekarzem</small>
  </div>

  <div class="tabs">
    <button class="tab active" onclick="switchTab('planner')">üìÖ Planner</button>
    <button class="tab" onclick="switchTab('manage')">‚öôÔ∏è ZarzƒÖdzaj danymi</button>
  </div>

  <div id="planner-tab" class="tab-content active">
    <div class="meal-count-selector">
      <label>Liczba posi≈Çk√≥w dziennie:</label>
      <label><input type="radio" name="mealCount" value="3" checked onchange="updateMealCount()"> 3 posi≈Çki (≈õniadanie, obiad, kolacja)</label>
      <label><input type="radio" name="mealCount" value="4" onchange="updateMealCount()"> 4 posi≈Çki (+ podwieczorek)</label>
    </div>
    
    <div class="action-buttons">
      <button class="btn-action btn-randomize" onclick="randomizujPlan()">üé≤ Randomizuj ca≈Çy tydzie≈Ñ</button>
      <button class="btn-action btn-reset" onclick="resetujPlan()">üîÑ Resetuj do pierwszych da≈Ñ</button>
      <button class="btn-action btn-save" onclick="zapiszPlan()">üíæ Zapisz aktualny plan</button>
      <button class="btn-action btn-load" onclick="toggleSavedPlans()">üìÇ Wczytaj zapisany plan</button>
    </div>
    
    <div id="savedPlansSection" style="display: none;" class="saved-plans">
      <h3 style="margin-top: 0;">üìã Zapisane plany:</h3>
      <div id="savedPlansList"></div>
    </div>

    <div id="dropdowns"></div>
    <button onclick="generujPlan()">üìã Poka≈º jad≈Çospis i listƒô zakup√≥w</button>

    <div id="plan"></div>
    <div id="zakupy"></div>
  </div>

  <div id="manage-tab" class="tab-content">
    <h2>‚öôÔ∏è ZarzƒÖdzaj bazƒÖ da≈Ñ</h2>
    
    <div style="background: #fff; padding: 20px; border-radius: 8px; border: 2px solid #ddd; margin-bottom: 20px;">
      <h3>‚ûï Dodaj nowe danie</h3>
      <div class="form-group">
        <label>Typ posi≈Çku:</label>
        <select id="newDishType" style="width: 100%;">
          <option value="≈õniadanie">≈öniadanie</option>
          <option value="obiad">Obiad</option>
          <option value="kolacja">Kolacja</option>
          <option value="podwieczorek">Podwieczorek</option>
        </select>
      </div>
      <div class="form-group">
        <label>Nazwa dania:</label>
        <input type="text" id="newDishName" placeholder="np. Owsianka z owocami">
      </div>
      <div class="form-group">
        <label>Przepis (opcjonalnie):</label>
        <textarea id="newDishRecipe" placeholder="Wpisz przepis krok po kroku..."></textarea>
      </div>
      <div class="form-group">
        <label>Sk≈Çadniki (JSON format): [Produkt, gramatura Michalina, gramatura Marcin]</label>
        <textarea id="newDishIngredients" placeholder="{
  'P≈Çatki owsiane': [40, 70],
  'Mleko 2%': [120, 200],
  'Banan': [60, 100]
}"></textarea>
      </div>
      <button onclick="addNewDish()" style="width: 100%; background: #28a745; color: white; padding: 12px; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; font-weight: bold;">‚úÖ Dodaj danie</button>
    </div>

    <h3>üìã Lista wszystkich da≈Ñ</h3>
    <div id="dishList" class="dish-list"></div>
  </div>
</div>

<script src="data.js"></script>
<script src="script.js"></script>
</body>
</html>
  * {
    box-sizing: border-box;
  }
  
  body { 
    font-family: Arial, sans-serif; 
    margin: 0;
    padding: 20px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
  }
  
  .container {
    max-width: 1200px;
    margin: 0 auto;
    background: white;
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.2);
  }
  
  h1 { 
    color: #236be8; 
    text-align: center;
    margin-bottom: 10px;
    font-size: 2em;
  }
  
  .tabs {
    display: flex;
    border-bottom: 2px solid #236be8;
    margin-bottom: 20px;
    gap: 5px;
  }
  
  .tab {
    padding: 12px 24px;
    background: #f0f0f0;
    border: none;
    cursor: pointer;
    font-size: 16px;
    font-weight: bold;
    border-radius: 8px 8px 0 0;
    transition: all 0.3s;
  }
  
  .tab:hover {
    background: #e0e0e0;
  }
  
  .tab.active {
    background: #236be8;
    color: white;
  }
  
  .tab-content {
    display: none;
  }
  
  .tab-content.active {
    display: block;
  }
  
  h2 { 
    color: #236be8; 
    border-bottom: 3px solid #236be8;
    padding-bottom: 10px;
    margin-top: 40px;
  }
  
  .intro {
    text-align: center;
    color: #555;
    margin-bottom: 30px;
    line-height: 1.6;
  }
  
  table { 
    width: 100%;
    margin-bottom: 30px; 
    border-collapse: collapse;
    overflow-x: auto;
    display: block;
  }
  
  @media (min-width: 768px) {
    table {
      display: table;
    }
  }
  
  th, td { 
    border: 1px solid #ddd; 
    padding: 12px 10px;
    text-align: left;
  }
  
  th {
    background: #236be8;
    color: white;
    font-weight: bold;
    position: sticky;
    top: 0;
  }
  
  tr:nth-child(even) {
    background: #f9f9f9;
  }
  
  tr:hover {
    background: #e8f4ff;
  }
  
  select {
    width: 100%;
    padding: 8px;
    border: 2px solid #ddd;
    border-radius: 5px;
    font-size: 14px;
    background: white;
    cursor: pointer;
    transition: border-color 0.3s;
  }
  
  select:focus {
    outline: none;
    border-color: #236be8;
  }
  
  button { 
    width: 100%;
    max-width: 400px;
    margin: 20px auto;
    display: block;
    padding: 15px;
    background: #236be8;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 18px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 4px 15px rgba(35, 107, 232, 0.3);
  }
  
  button:hover {
    background: #1a57c4;
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(35, 107, 232, 0.4);
  }
  
  button:active {
    transform: translateY(0);
  }
  
  #plan, #zakupy {
    margin-top: 40px;
  }
  
  .result-section {
    animation: fadeIn 0.5s ease-in;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  /* Responsywno≈õƒá dla ma≈Çych ekran√≥w */
  @media (max-width: 768px) {
    .container {
      padding: 15px;
      border-radius: 0;
    }
    
    h1 {
      font-size: 1.5em;
    }
    
    h2 {
      font-size: 1.3em;
    }
    
    body {
      padding: 0;
    }
    
    table {
      font-size: 12px;
    }
    
    th, td {
      padding: 8px 5px;
    }
    
    select {
      font-size: 12px;
      padding: 6px;
    }
    
    button {
      font-size: 16px;
      padding: 12px;
    }
  }
  
  @media (max-width: 480px) {
    table {
      font-size: 11px;
    }
    
    th, td {
      padding: 6px 3px;
    }
    
    h1 {
      font-size: 1.3em;
    }
  }
  
  .person-michalina {
    color: #e91e63;
    font-weight: 600;
  }
  
  .person-marcin {
    color: #2196f3;
    font-weight: 600;
  }
  
  .day-label {
    font-weight: bold;
    color: #333;
  }
  
  .loading {
    text-align: center;
    padding: 20px;
    color: #666;
  }
  
  .meal-count-selector {
    background: #fff3cd;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
    border-left: 4px solid #ffc107;
  }
  
  .meal-count-selector label {
    margin-right: 15px;
    font-weight: bold;
  }
  
  .form-group {
    margin-bottom: 15px;
  }
  
  .form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
    color: #333;
  }
  
  .form-group input, .form-group textarea {
    width: 100%;
    padding: 8px;
    border: 2px solid #ddd;
    border-radius: 5px;
    font-size: 14px;
  }
  
  .form-group textarea {
    min-height: 100px;
    font-family: Arial, sans-serif;
  }
  
  .btn-secondary {
    background: #6c757d;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    margin: 5px;
  }
  
  .btn-secondary:hover {
    background: #5a6268;
  }
  
  .btn-danger {
    background: #dc3545;
    color: white;
    padding: 8px 15px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 12px;
  }
  
  .btn-danger:hover {
    background: #c82333;
  }
  
  .dish-list {
    margin-top: 20px;
  }
  
  .dish-item {
    background: #f9f9f9;
    padding: 15px;
    margin-bottom: 10px;
    border-radius: 8px;
    border-left: 4px solid #236be8;
  }
  
  .dish-item h4 {
    margin-top: 0;
    color: #236be8;
  }
  
  .info-box {
    background: #e8f4ff;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
    border-left: 4px solid #2196f3;
  }
  
  .action-buttons {
    display: flex;
    gap: 10px;
    margin: 20px 0;
    flex-wrap: wrap;
  }
  
  .btn-action {
    flex: 1;
    min-width: 150px;
    padding: 12px 20px;
    border: none;
    border-radius: 8px;
    font-size: 15px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  
  .btn-action:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  }
  
  .btn-randomize {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
  }
  
  .btn-reset {
    background: #ff9800;
    color: white;
  }
  
  .btn-save {
    background: #4caf50;
    color: white;
  }
  
  .btn-load {
    background: #2196f3;
    color: white;
  }
  
  .saved-plans {
    background: #f9f9f9;
    padding: 15px;
    border-radius: 8px;
    margin-top: 20px;
    border: 2px solid #ddd;
  }
  
  .saved-plan-item {
    background: white;
    padding: 10px;
    margin: 5px 0;
    border-radius: 5px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-left: 4px solid #236be8;
  }
  
  .saved-plan-item:hover {
    background: #f0f7ff;
  }
  
  @media (max-width: 768px) {
    .action-buttons {
      flex-direction: column;
    }
    
    .btn-action {
      width: 100%;
    }
  }
</style>
</head>
<body>
<div class="container">
  <h1>üçΩÔ∏è Planner Dietetyczny</h1>
  <p class="intro">Wybierz dania na ka≈ºdy dzie≈Ñ tygodnia dla <span class="person-michalina">Michaliny</span> i <span class="person-marcin">Marcina</span>.<br>
  Po wyborze wszystkich posi≈Çk√≥w, wygeneruj jad≈Çospis i automatycznƒÖ listƒô zakup√≥w!</p>
  
  <div class="info-box">
    <h3 style="margin-top: 0; color: #2196f3;">üìä Cel kaloryczny dzienny</h3>
    <div style="display: flex; gap: 20px; flex-wrap: wrap; margin-top: 15px;">
      <div style="flex: 1; min-width: 200px;">
        <label style="display: block; margin-bottom: 8px;"><strong class="person-michalina">Michalina:</strong></label>
        <select id="caloriesMichalina" onchange="updateCalories()" style="width: 100%; padding: 8px; border: 2px solid #e91e63; border-radius: 5px; font-size: 14px;">
          <option value="1000">1000 kcal</option>
          <option value="1300" selected>1300 kcal</option>
          <option value="1500">1500 kcal</option>
          <option value="1800">1800 kcal</option>
          <option value="2000">2000 kcal</option>
          <option value="2500">2500 kcal</option>
        </select>
      </div>
      <div style="flex: 1; min-width: 200px;">
        <label style="display: block; margin-bottom: 8px;"><strong class="person-marcin">Marcin:</strong></label>
        <select id="caloriesMarcin" onchange="updateCalories()" style="width: 100%; padding: 8px; border: 2px solid #2196f3; border-radius: 5px; font-size: 14px;">
          <option value="1500">1500 kcal</option>
          <option value="2000">2000 kcal</option>
          <option value="2500" selected>2500 kcal</option>
          <option value="3000">3000 kcal</option>
        </select>
      </div>
    </div>
    <small style="color: #666; display: block; margin-top: 10px;">üí° Gramatury sk≈Çadnik√≥w bƒôdƒÖ automatycznie dostosowane do wybranego celu</small>
  </div>
  
  <div style="background: #f0f7ff; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #236be8;">
    <h3 style="margin-top: 0; color: #236be8;">üíä Suplementacja</h3>
    <p style="margin: 5px 0;"><strong class="person-michalina">Michalina:</strong> Witamina D3+K2 (2000IU), Omega-3, Multiwitamina/probiotyk, Izolat bia≈Çka (w razie braku bia≈Çka w diecie)</p>
    <p style="margin: 5px 0;"><strong class="person-marcin">Marcin:</strong> Witamina D3 (2000IU), Omega-3, Magnez, Izolat bia≈Çka (po biegu)</p>
    <small style="color: #666;">* Suplementacja po konsultacji z lekarzem</small>
  </div>

  <div class="tabs">
    <button class="tab active" onclick="switchTab('planner')">üìÖ Planner</button>
    <button class="tab" onclick="switchTab('manage')">‚öôÔ∏è ZarzƒÖdzaj danymi</button>
  </div>

  <div id="planner-tab" class="tab-content active">
    <div class="meal-count-selector">
      <label>Liczba posi≈Çk√≥w dziennie:</label>
      <label><input type="radio" name="mealCount" value="3" checked onchange="updateMealCount()"> 3 posi≈Çki (≈õniadanie, obiad, kolacja)</label>
      <label><input type="radio" name="mealCount" value="4" onchange="updateMealCount()"> 4 posi≈Çki (+ podwieczorek)</label>
    </div>
    
    <div class="action-buttons">
      <button class="btn-action btn-randomize" onclick="randomizujPlan()">üé≤ Randomizuj ca≈Çy tydzie≈Ñ</button>
      <button class="btn-action btn-reset" onclick="resetujPlan()">üîÑ Resetuj do pierwszych da≈Ñ</button>
      <button class="btn-action btn-save" onclick="zapiszPlan()">üíæ Zapisz aktualny plan</button>
      <button class="btn-action btn-load" onclick="toggleSavedPlans()">üìÇ Wczytaj zapisany plan</button>
    </div>
    
    <div id="savedPlansSection" style="display: none;" class="saved-plans">
      <h3 style="margin-top: 0;">üìã Zapisane plany:</h3>
      <div id="savedPlansList"></div>
    </div>

    <div id="dropdowns"></div>
    <button onclick="generujPlan()">üìã Poka≈º jad≈Çospis i listƒô zakup√≥w</button>

    <div id="plan"></div>
    <div id="zakupy"></div>
  </div>

  <div id="manage-tab" class="tab-content">
    <h2>‚öôÔ∏è ZarzƒÖdzaj bazƒÖ da≈Ñ</h2>
    
    <div style="background: #fff; padding: 20px; border-radius: 8px; border: 2px solid #ddd; margin-bottom: 20px;">
      <h3>‚ûï Dodaj nowe danie</h3>
      <div class="form-group">
        <label>Typ posi≈Çku:</label>
        <select id="newDishType" style="width: 100%;">
          <option value="≈õniadanie">≈öniadanie</option>
          <option value="obiad">Obiad</option>
          <option value="kolacja">Kolacja</option>
          <option value="podwieczorek">Podwieczorek</option>
        </select>
      </div>
      <div class="form-group">
        <label>Nazwa dania:</label>
        <input type="text" id="newDishName" placeholder="np. Owsianka z owocami">
      </div>
      <div class="form-group">
        <label>Przepis (opcjonalnie):</label>
        <textarea id="newDishRecipe" placeholder="Wpisz przepis krok po kroku..."></textarea>
      </div>
      <div class="form-group">
        <label>Sk≈Çadniki (JSON format): [Produkt, gramatura Michalina, gramatura Marcin]</label>
        <textarea id="newDishIngredients" placeholder="{
  'P≈Çatki owsiane': [40, 70],
  'Mleko 2%': [120, 200],
  'Banan': [60, 100]
}"></textarea>
      </div>
      <button onclick="addNewDish()" style="width: 100%; background: #28a745; color: white; padding: 12px; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; font-weight: bold;">‚úÖ Dodaj danie</button>
    </div>

    <h3>üìã Lista wszystkich da≈Ñ</h3>
    <div id="dishList" class="dish-list"></div>
  </div>
</div>

<script>
// ---------- BAZA DA≈É ----------
const dania = {
  "≈õniadanie": [
    {
      nazwa: "Owsianka z bananem i orzechami",
      skladniki: {'P≈Çatki owsiane': [40,70],'Mleko 2%': [120,200],'Banan': [60,100],'Orzechy w≈Çoskie':[5,10],'Izolat bia≈Çka':[0,20]}
    },
    {
      nazwa: "Jajecznica z paprykƒÖ",
      skladniki: {'Jajka': [2,3],'Papryka':[40,80],'Chleb pe≈Çnoziarnisty':[40,80],'Mas≈Ço':[5,10]}
    },
    {
      nazwa: "Musli z jogurtem greckim i jagodami",
      skladniki: {'Musli': [40,70],'Jogurt grecki': [100,200],'Maliny/jagody mro≈ºone': [50,100]}
    },
    {
      nazwa: "Kanapka z kurczakiem",
      skladniki: {'Kurczak gotowany':[40,70],'Sa≈Çata':[20,40],'Pomidor':[40,80],'Pieczywo pe≈Çnoziarniste':[40,80]}
    },
    {
      nazwa: "Musli z jogurtem i jab≈Çkiem",
      skladniki: {'Musli': [40,70],'Jogurt naturalny': [100,200],'Jab≈Çko': [60,120]}
    },
    {
      nazwa: "Jajecznica ze szczypiorkiem",
      skladniki: {'Jajka': [2,3],'Szczypiorek':[5,10],'Chleb pe≈Çnoziarnisty':[40,80],'Mas≈Ço':[5,10]}
    },
    {
      nazwa: "Kasza jaglana z jogurtem i owocami",
      skladniki: {'Kasza jaglana': [40,70],'Jogurt naturalny': [100,200],'≈öliwka/jab≈Çko': [50,100],'Orzechy w≈Çoskie':[5,10]}
    }
  ],
  "obiad": [
    {
      nazwa: "Kurczak pieczony z batatami",
      skladniki: {'Pier≈õ kurczaka':[120,170],'Bataty':[100,200],'Warzywa (mix)':[100,200],'Oliwa':[5,10]}
    },
    {
      nazwa: "Indyk z kaszƒÖ bulgur",
      skladniki: {'Filet z indyka':[120,170],'Kasza bulgur':[40,80],'Marchew':[40,70],'Broku≈Ç':[60,100],'Oliwa':[5,10]}
    },
    {
      nazwa: "Kurczak z makaronem w passacie",
      skladniki: {'Pier≈õ kurczaka':[120,170],'Makaron pe≈Çnoziarnisty':[40,80],'Cukinia':[40,80],'Papryka':[40,80],'Passata pomidorowa':[100,150]}
    },
    {
      nazwa: "Kurczak z kaszƒÖ jaglanƒÖ i marchewkƒÖ",
      skladniki: {'Pier≈õ z kurczaka':[120,170],'Kasza jaglana':[40,80],'Marchew':[40,80],'Passata pomidorowa':[80,120]}
    },
    {
      nazwa: "Kurczak z fasolkƒÖ szparagowƒÖ",
      skladniki: {'Pier≈õ z kurczaka':[120,170],'Fasolka szparagowa':[80,130],'Ry≈º brƒÖzowy':[40,80],'Olej rzepakowy':[5,10]}
    },
    {
      nazwa: "Indyk pieczony z warzywami",
      skladniki: {'Indyk (pieczony filet)':[120,170],'Marchewka':[40,80],'Cukinia/papryka':[40,80],'Ziemniaki':[80,150],'Oliwa':[5,10]}
    },
    {
      nazwa: "Pulpeciki z indyka z ry≈ºem",
      skladniki: {'Kulki/pulpeciki z indyka':[120,170],'Ry≈º':[40,80],'Warzywa do pieczenia (cukinia, marchew)':[80,150],'Oliwa':[5,10]}
    }
  ],
  "kolacja": [
    {
      nazwa: "Sa≈Çatka z tu≈Ñczykiem",
      skladniki: {'Tu≈Ñczyk w wodzie':[50,100],'Kukurydza':[25,50],'Papryka/og√≥rek':[50,100],'Sa≈Çata':[30,50],'Pieczywo pe≈Çnoziarniste':[40,80]}
    },
    {
      nazwa: "Twaro≈ºek ze szczypiorkiem",
      skladniki: {'Twaro≈ºek p√≥≈Çt≈Çusty':[80,150],'Szczypiorek':[5,10],'Rzodkiewka':[30,50],'Pieczywo ≈ºytnie':[40,80]}
    },
    {
      nazwa: "Sa≈Çatka z fetƒÖ",
      skladniki: {'Sa≈Çata rzymska':[40,80],'Feta':[20,40],'Pomidor':[40,80],'Pestki dyni':[5,10]}
    },
    {
      nazwa: "Stir fry warzywny z tofu",
      skladniki: {'Stir fry warzywny (warzywa mro≈ºone)':[120,200],'Tofu naturalne':[60,120],'Oliwa':[5,10]}
    },
    {
      nazwa: "Wrap z pastƒÖ jajecznƒÖ",
      skladniki: {'Wrap pszenny pe≈Çnoziarnisty':[40,80],'Warzywa pokrojone':[60,120],'Pasta jajeczna':[60,120]}
    },
    {
      nazwa: "Wƒôdzony ≈Çoso≈õ z sa≈ÇatkƒÖ",
      skladniki: {'Wƒôdzony ≈Çoso≈õ':[40,80],'Sa≈Çata':[30,50],'Kukurydza':[25,50],'Pieczywo pe≈Çnoziarniste':[40,80]}
    },
    {
      nazwa: "Hummus z warzywami",
      skladniki: {'Hummus':[40,80],'Pomidor':[40,80],'Pieczywo chrupkie':[20,40]}
    }
  ],
  "podwieczorek": [
    {
      nazwa: "Owoce z orzechami",
      skladniki: {'Jab≈Çko/gruszka': [80,120],'Orzechy w≈Çoskie':[10,20]}
    },
    {
      nazwa: "Jogurt z owocami",
      skladniki: {'Jogurt naturalny': [100,150],'Maliny/jagody':[50,80]}
    },
    {
      nazwa: "Batony proteinowe",
      skladniki: {'Baton proteinowy': [1,1]}
    }
  ]
};

let currentMealCount = 3;

// Bazowe warto≈õci kalorii (do skalowania)
const BASE_CALORIES_MICHALINA = 1300;
const BASE_CALORIES_MARCIN = 2500;

let currentCaloriesMichalina = 1300;
let currentCaloriesMarcin = 2500;

// Funkcja skalowania gramatur
function scaleAmount(baseAmount, isForMarcin) {
  if(isForMarcin) {
    return Math.round(baseAmount * (currentCaloriesMarcin / BASE_CALORIES_MARCIN));
  } else {
    return Math.round(baseAmount * (currentCaloriesMichalina / BASE_CALORIES_MICHALINA));
  }
}

function updateCalories() {
  currentCaloriesMichalina = parseInt(document.getElementById('caloriesMichalina').value);
  currentCaloriesMarcin = parseInt(document.getElementById('caloriesMarcin').value);
  
  // Zapisz w localStorage
  localStorage.setItem('caloriesMichalina', currentCaloriesMichalina);
  localStorage.setItem('caloriesMarcin', currentCaloriesMarcin);
  
  // Od≈õwie≈º wy≈õwietlanie je≈õli plan jest wygenerowany
  const planElement = document.getElementById('plan');
  if(planElement.innerHTML) {
    generujPlan();
  }
}

// Wczytaj zapisane kalorie
function loadSavedCalories() {
  const savedMichalina = localStorage.getItem('caloriesMichalina');
  const savedMarcin = localStorage.getItem('caloriesMarcin');
  
  if(savedMichalina) {
    currentCaloriesMichalina = parseInt(savedMichalina);
    document.getElementById('caloriesMichalina').value = savedMichalina;
  }
  
  if(savedMarcin) {
    currentCaloriesMarcin = parseInt(savedMarcin);
    document.getElementById('caloriesMarcin').value = savedMarcin;
  }
}

// ---------- TWORZENIE DROPDOWN√ìW ----------
const dni = ["Poniedzia≈Çek","Wtorek","≈öroda","Czwartek","PiƒÖtek","Sobota","Niedziela"];
const dropdowns = document.getElementById("dropdowns");

function createDropdowns() {
  let posilki = currentMealCount === 3 ? 
    ["≈õniadanie","obiad","kolacja"] : 
    ["≈õniadanie","obiad","podwieczorek","kolacja"];
  
  let posilkiLabels = {
    "≈õniadanie": "üåÖ ≈öniadanie",
    "obiad": "üç¥ Obiad",
    "podwieczorek": "üçé Podwieczorek",
    "kolacja": "üåô Kolacja"
  };
  
  let html = "<table><tr><th>Dzie≈Ñ</th>";
  posilki.forEach(p => {
    html += "<th>"+posilkiLabels[p]+"</th>";
  });
  html += "</tr>";
  
  for(let i=0;i<dni.length;i++){
    html += "<tr><td class='day-label'>"+dni[i]+"</td>";
    posilki.forEach(posilek=>{
      html += "<td><select id='"+posilek+i+"'>";
      if(dania[posilek]) {
        dania[posilek].forEach((d,j)=>{
          html+="<option value='"+j+"'>"+d.nazwa+"</option>";
        });
      }
      html+="</select></td>";
    });
    html+="</tr>";
  }
  html+="</table>";
  dropdowns.innerHTML = html;
  
  // Dodaj event listenery
  setTimeout(() => {
    wczytajWybor();
    for(let i=0; i<dni.length; i++){
      posilki.forEach(posilek => {
        const el = document.getElementById(posilek+i);
        if(el) el.addEventListener('change', zapiszWybor);
      });
    }
  }, 100);
}

createDropdowns();

// ---------- GENEROWANIE PLANU I SHOPPING LIST ----------
function generujPlan(){
  let posilki = currentMealCount === 3 ? 
    ["≈õniadanie","obiad","kolacja"] : 
    ["≈õniadanie","obiad","podwieczorek","kolacja"];
    
  let plan = "<div class='result-section'><h2>üìÖ Jad≈Çospis na tydzie≈Ñ</h2><table><tr><th>Dzie≈Ñ</th><th>Posi≈Çek</th><th class='person-michalina'>Michalina</th><th class='person-marcin'>Marcin</th></tr>";
  let zakupy = {}; // sumowanie sk≈Çadnik√≥w
  
  for(let i=0;i<dni.length;i++){
    posilki.forEach(posilek=>{
      let idx = +document.getElementById(posilek+i).value;
      let d = dania[posilek][idx];
      
      let posilekDisplay = posilek === "≈õniadanie" ? "üåÖ ≈öniadanie" : 
                          posilek === "obiad" ? "üç¥ Obiad" : 
                          posilek === "podwieczorek" ? "üçé Podwieczorek" : "üåô Kolacja";
      
      plan+="<tr><td class='day-label'>"+dni[i]+"</td><td><b>"+d.nazwa+"</b></td><td class='person-michalina'>";
      let skladM = [], skladMA = [];
      
      for (const [skladnik,[gramM,gramMA]] of Object.entries(d.skladniki)){
        // Sprawd≈∫ czy to sztuki czy gramy
        let jednostka = skladnik === "Jajka" || skladnik.includes("Baton") ? "szt" : "g";
        
        // Przeskaluj gramatury wed≈Çug wybranego celu kalorycznego
        let scaledM = jednostka === "szt" ? gramM : scaleAmount(gramM, false);
        let scaledMA = jednostka === "szt" ? gramMA : scaleAmount(gramMA, true);
        
        skladM.push(skladnik+": "+scaledM+jednostka);
        skladMA.push(skladnik+": "+scaledMA+jednostka);
        
        // dodaj do listy zakup√≥w
        zakupy[skladnik] = zakupy[skladnik] || {michalina:0, marcin:0, jednostka: jednostka};
        zakupy[skladnik].michalina += scaledM;
        zakupy[skladnik].marcin += scaledMA;
      }
      plan+=skladM.join(", ")+"</td><td class='person-marcin'>"+skladMA.join(", ")+"</td></tr>";
    });
  }
  plan+="</table></div>";

  // Generowanie listy zakup√≥w
  let zakHTML = "<div class='result-section'><h2>üõí Lista zakup√≥w na tydzie≈Ñ</h2><table><tr><th>Produkt</th><th class='person-michalina'>Michalina</th><th class='person-marcin'>Marcin</th><th>RAZEM</th></tr>";
  
  // Sortuj alfabetycznie
  const sortedProducts = Object.keys(zakupy).sort();
  
  for(const prod of sortedProducts){
    const data = zakupy[prod];
    const suma = data.michalina + data.marcin;
    zakHTML+="<tr><td><b>"+prod+"</b></td><td class='person-michalina'>"+data.michalina+" "+data.jednostka+"</td><td class='person-marcin'>"+data.marcin+" "+data.jednostka+"</td><td><b>"+suma+" "+data.jednostka+"</b></td></tr>";
  }
  zakHTML+="</table></div>";

  document.getElementById("plan").innerHTML = plan;
  document.getElementById("zakupy").innerHTML = zakHTML;
  
  // Smooth scroll do wynik√≥w
  setTimeout(() => {
    document.getElementById("plan").scrollIntoView({ behavior: 'smooth', block: 'start' });
  }, 100);
}

// Automatyczne zapisywanie wyboru w localStorage
function zapiszWybor() {
  const wybor = {};
  let posilki = currentMealCount === 3 ? 
    ["≈õniadanie","obiad","kolacja"] : 
    ["≈õniadanie","obiad","podwieczorek","kolacja"];
  
  for(let i=0; i<dni.length; i++){
    wybor[i] = {};
    posilki.forEach(posilek => {
      const el = document.getElementById(posilek+i);
      if(el) wybor[i][posilek] = el.value;
    });
  }
  localStorage.setItem('plannerWybor', JSON.stringify(wybor));
  localStorage.setItem('plannerMealCount', currentMealCount);
}

function wczytajWybor() {
  const zapisany = localStorage.getItem('plannerWybor');
  const savedMealCount = localStorage.getItem('plannerMealCount');
  
  if(savedMealCount) {
    currentMealCount = parseInt(savedMealCount);
    document.querySelector(`input[name="mealCount"][value="${currentMealCount}"]`).checked = true;
  }
  
  if(zapisany) {
    const wybor = JSON.parse(zapisany);
    let posilki = currentMealCount === 3 ? 
      ["≈õniadanie","obiad","kolacja"] : 
      ["≈õniadanie","obiad","podwieczorek","kolacja"];
    
    for(let i=0; i<dni.length; i++){
      if(wybor[i]) {
        posilki.forEach(posilek => {
          const el = document.getElementById(posilek+i);
          if(el && wybor[i][posilek] !== undefined) {
            el.value = wybor[i][posilek];
          }
        });
      }
    }
  }
}

function updateMealCount() {
  currentMealCount = parseInt(document.querySelector('input[name="mealCount"]:checked').value);
  createDropdowns();
  zapiszWybor();
}

function switchTab(tabName) {
  // Ukryj wszystkie zak≈Çadki
  document.querySelectorAll('.tab-content').forEach(tab => {
    tab.classList.remove('active');
  });
  document.querySelectorAll('.tab').forEach(tab => {
    tab.classList.remove('active');
  });
  
  // Poka≈º wybranƒÖ zak≈Çadkƒô
  document.getElementById(tabName + '-tab').classList.add('active');
  event.target.classList.add('active');
  
  if(tabName === 'manage') {
    displayDishList();
  }
}

function addNewDish() {
  const type = document.getElementById('newDishType').value;
  const name = document.getElementById('newDishName').value.trim();
  const recipe = document.getElementById('newDishRecipe').value.trim();
  const ingredientsText = document.getElementById('newDishIngredients').value.trim();
  
  if(!name) {
    alert('Proszƒô podaƒá nazwƒô dania!');
    return;
  }
  
  if(!ingredientsText) {
    alert('Proszƒô podaƒá sk≈Çadniki!');
    return;
  }
  
  try {
    // Parsuj sk≈Çadniki
    const ingredients = eval('(' + ingredientsText + ')');
    
    const newDish = {
      nazwa: name,
      skladniki: ingredients
    };
    
    if(recipe) {
      newDish.przepis = recipe;
    }
    
    // Dodaj do bazy
    if(!dania[type]) dania[type] = [];
    dania[type].push(newDish);
    
    // Zapisz w localStorage
    localStorage.setItem('daniaCustom', JSON.stringify(dania));
    
    // Wyczy≈õƒá formularz
    document.getElementById('newDishName').value = '';
    document.getElementById('newDishRecipe').value = '';
    document.getElementById('newDishIngredients').value = '';
    
    alert('‚úÖ Danie zosta≈Ço dodane!');
    createDropdowns();
    displayDishList();
  } catch(e) {
    alert('‚ùå B≈ÇƒÖd w formacie sk≈Çadnik√≥w! Sprawd≈∫ sk≈Çadniƒô JSON.');
  }
}

function displayDishList() {
  let html = '';
  
  ['≈õniadanie', 'obiad', 'podwieczorek', 'kolacja'].forEach(type => {
    if(dania[type] && dania[type].length > 0) {
      html += `<h4 style="color: #236be8; margin-top: 20px;">${type.charAt(0).toUpperCase() + type.slice(1)}</h4>`;
      
      dania[type].forEach((dish, idx) => {
        html += `<div class="dish-item">`;
        html += `<h4>${dish.nazwa}</h4>`;
        
        if(dish.przepis) {
          html += `<p><strong>Przepis:</strong> ${dish.przepis}</p>`;
        }
        
        html += `<p><strong>Sk≈Çadniki:</strong></p><ul>`;
        for(const [ingredient, [g1, g2]] of Object.entries(dish.skladniki)) {
          let jednostka = ingredient === "Jajka" || ingredient.includes("Baton") ? "szt" : "g";
          html += `<li>${ingredient}: <span class="person-michalina">${g1}${jednostka}</span> / <span class="person-marcin">${g2}${jednostka}</span></li>`;
        }
        html += `</ul>`;
        html += `<button class="btn-danger" onclick="deleteDish('${type}', ${idx})">üóëÔ∏è Usu≈Ñ</button>`;
        html += `</div>`;
      });
    }
  });
  
  document.getElementById('dishList').innerHTML = html;
}

function deleteDish(type, index) {
  if(confirm('Czy na pewno chcesz usunƒÖƒá to danie?')) {
    dania[type].splice(index, 1);
    localStorage.setItem('daniaCustom', JSON.stringify(dania));
    createDropdowns();
    displayDishList();
    alert('‚úÖ Danie zosta≈Ço usuniƒôte!');
  }
}

// Wczytaj customowe dania z localStorage
function loadCustomDishes() {
  const customDishes = localStorage.getItem('daniaCustom');
  if(customDishes) {
    try {
      const parsed = JSON.parse(customDishes);
      // Merge z istniejƒÖcymi
      Object.keys(parsed).forEach(type => {
        if(parsed[type] && Array.isArray(parsed[type])) {
          dania[type] = parsed[type];
        }
      });
    } catch(e) {
      console.error('B≈ÇƒÖd wczytywania customowych da≈Ñ:', e);
    }
  }
}

// Wczytaj przy starcie
loadCustomDishes();
loadSavedCalories();

// ---------- FUNKCJE RANDOMIZACJI I ZARZƒÑDZANIA PLANAMI ----------

function randomizujPlan() {
  if(!confirm('üé≤ Czy na pewno chcesz wylosowaƒá dania na ca≈Çy tydzie≈Ñ?\n\nObecny wyb√≥r zostanie nadpisany.')) {
    return;
  }
  
  let posilki = currentMealCount === 3 ? 
    ["≈õniadanie","obiad","kolacja"] : 
    ["≈õniadanie","obiad","podwieczorek","kolacja"];
  
  for(let i=0; i<dni.length; i++){
    posilki.forEach(posilek => {
      const el = document.getElementById(posilek+i);
      if(el && dania[posilek] && dania[posilek].length > 0) {
        const randomIndex = Math.floor(Math.random() * dania[posilek].length);
        el.value = randomIndex;
      }
    });
  }
  
  zapiszWybor();
  alert('‚úÖ Plan zosta≈Ç wylosowany! Mo≈ºesz teraz wygenerowaƒá jad≈Çospis.');
}

function resetujPlan() {
  if(!confirm('üîÑ Czy na pewno chcesz zresetowaƒá plan?\n\nWszystkie posi≈Çki zostanƒÖ ustawione na pierwsze pozycje z listy.')) {
    return;
  }
  
  let posilki = currentMealCount === 3 ? 
    ["≈õniadanie","obiad","kolacja"] : 
    ["≈õniadanie","obiad","podwieczorek","kolacja"];
  
  for(let i=0; i<dni.length; i++){
    posilki.forEach(posilek => {
      const el = document.getElementById(posilek+i);
      if(el) {
        el.value = 0;
      }
    });
  }
  
  zapiszWybor();
  alert('‚úÖ Plan zosta≈Ç zresetowany!');
}

function zapiszPlan() {
  const planName = prompt('üíæ Podaj nazwƒô dla tego planu:', 'Plan ' + new Date().toLocaleDateString('pl-PL'));
  
  if(!planName) return;
  
  let posilki = currentMealCount === 3 ? 
    ["≈õniadanie","obiad","kolacja"] : 
    ["≈õniadanie","obiad","podwieczorek","kolacja"];
  
  const plan = {
    name: planName,
    date: new Date().toISOString(),
    mealCount: currentMealCount,
    meals: {}
  };
  
  for(let i=0; i<dni.length; i++){
    plan.meals[i] = {};
    posilki.forEach(posilek => {
      const el = document.getElementById(posilek+i);
      if(el) {
        plan.meals[i][posilek] = parseInt(el.value);
      }
    });
  }
  
  // Pobierz zapisane plany
  let savedPlans = JSON.parse(localStorage.getItem('savedMealPlans') || '[]');
  
  // Dodaj nowy plan
  savedPlans.push(plan);
  
  // Zapisz
  localStorage.setItem('savedMealPlans', JSON.stringify(savedPlans));
  
  alert('‚úÖ Plan "' + planName + '" zosta≈Ç zapisany!');
  displaySavedPlans();
}

function wczytajPlan(index) {
  if(!confirm('üìÇ Czy na pewno chcesz wczytaƒá ten plan?\n\nObecny wyb√≥r zostanie nadpisany.')) {
    return;
  }
  
  const savedPlans = JSON.parse(localStorage.getItem('savedMealPlans') || '[]');
  
  if(index < 0 || index >= savedPlans.length) {
    alert('‚ùå Plan nie zosta≈Ç znaleziony!');
    return;
  }
  
  const plan = savedPlans[index];
  
  // Ustaw liczbƒô posi≈Çk√≥w
  if(plan.mealCount !== currentMealCount) {
    currentMealCount = plan.mealCount;
    document.querySelector(`input[name="mealCount"][value="${currentMealCount}"]`).checked = true;
    createDropdowns();
    
    // Czekaj na od≈õwie≈ºenie dropdown√≥w
    setTimeout(() => {
      loadPlanData(plan);
    }, 200);
  } else {
    loadPlanData(plan);
  }
}

function loadPlanData(plan) {
  let posilki = plan.mealCount === 3 ? 
    ["≈õniadanie","obiad","kolacja"] : 
    ["≈õniadanie","obiad","podwieczorek","kolacja"];
  
  for(let i=0; i<dni.length; i++){
    if(plan.meals[i]) {
      posilki.forEach(posilek => {
        const el = document.getElementById(posilek+i);
        if(el && plan.meals[i][posilek] !== undefined) {
          el.value = plan.meals[i][posilek];
        }
      });
    }
  }
  
  zapiszWybor();
  alert('‚úÖ Plan zosta≈Ç wczytany!');
  toggleSavedPlans();
}

function usunPlan(index) {
  if(!confirm('üóëÔ∏è Czy na pewno chcesz usunƒÖƒá ten plan?')) {
    return;
  }
  
  let savedPlans = JSON.parse(localStorage.getItem('savedMealPlans') || '[]');
  savedPlans.splice(index, 1);
  localStorage.setItem('savedMealPlans', JSON.stringify(savedPlans));
  
  displaySavedPlans();
  alert('‚úÖ Plan zosta≈Ç usuniƒôty!');
}

function toggleSavedPlans() {
  const section = document.getElementById('savedPlansSection');
  const isVisible = section.style.display !== 'none';
  
  if(isVisible) {
    section.style.display = 'none';
  } else {
    section.style.display = 'block';
    displaySavedPlans();
  }
}

function displaySavedPlans() {
  const savedPlans = JSON.parse(localStorage.getItem('savedMealPlans') || '[]');
  const container = document.getElementById('savedPlansList');
  
  if(savedPlans.length === 0) {
    container.innerHTML = '<p style="color: #666; text-align: center;">Brak zapisanych plan√≥w. Zapisz obecny plan, aby m√≥c go p√≥≈∫niej wczytaƒá.</p>';
    return;
  }
  
  let html = '';
  savedPlans.forEach((plan, index) => {
    const date = new Date(plan.date).toLocaleDateString('pl-PL', {year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit'});
    const mealCountText = plan.mealCount === 3 ? '3 posi≈Çki' : '4 posi≈Çki';
    
    html += `<div class="saved-plan-item">`;
    html += `<div>`;
    html += `<strong>${plan.name}</strong><br>`;
    html += `<small style="color: #666;">üìÖ ${date} | üçΩÔ∏è ${mealCountText}</small>`;
    html += `</div>`;
    html += `<div>`;
    html += `<button class="btn-secondary" onclick="wczytajPlan(${index})" style="margin-right: 5px;">üìÇ Wczytaj</button>`;
    html += `<button class="btn-danger" onclick="usunPlan(${index})">üóëÔ∏è</button>`;
    html += `</div>`;
    html += `</div>`;
  });
  
  container.innerHTML = html;
}



</script>
</body>
</html>